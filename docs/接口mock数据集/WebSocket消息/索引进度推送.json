{
  "接口信息": {
    "接口路径": "ws://127.0.0.1:8000/ws/index/{index_id}",
    "功能说明": "索引任务进度实时推送WebSocket连接",
    "连接方式": "WebSocket",
    "协议版本": "v1.0.0",
    "消息格式": "JSON"
  },
  "连接参数": {
    "正常连接场景": {
      "index_id": 1
    },
    "不存在的索引场景": {
      "index_id": 999
    }
  },
  "消息类型": {
    "progress_update": "进度更新消息",
    "file_processing": "文件处理状态消息",
    "error_occurred": "错误发生消息",
    "speed_update": "处理速度更新消息",
    "completed": "任务完成消息",
    "paused": "任务暂停消息",
    "cancelled": "任务取消消息",
    "heartbeat": "心跳保持消息"
  },
  "消息数据": {
    "进度更新消息": {
      "type": "progress_update",
      "data": {
        "index_id": 1,
        "status": "processing",
        "progress": 45,
        "processed_files": 45,
        "total_files": 100,
        "current_file": "D:/Documents/项目报告.docx",
        "processing_speed": "12 文件/秒",
        "estimated_remaining": "4 分 30 秒",
        "elapsed_time": "3 分 45 秒",
        "file_types_progress": {
          "pdf": {
            "processed": 15,
            "total": 25,
            "progress": 60
          },
          "docx": {
            "processed": 12,
            "total": 30,
            "progress": 40
          },
          "txt": {
            "processed": 8,
            "total": 15,
            "progress": 53
          },
          "md": {
            "processed": 6,
            "total": 20,
            "progress": 30
          },
          "xlsx": {
            "processed": 4,
            "total": 10,
            "progress": 40
          }
        },
        "errors_count": 2,
        "warnings_count": 1,
        "timestamp": "2024-01-20T10:05:30Z"
      }
    },
    "文件处理状态消息": {
      "type": "file_processing",
      "data": {
        "index_id": 1,
        "file_info": {
          "path": "D:/Documents/技术文档.pdf",
          "name": "技术文档.pdf",
          "size": 2048576,
          "type": "pdf",
          "last_modified": "2024-01-15T10:30:00Z"
        },
        "processing_stage": "content_extraction",
        "stage_progress": 75,
        "content_preview": "人工智能技术发展现状与未来趋势...",
        "metadata": {
          "title": "人工智能技术发展报告",
          "author": "技术团队",
          "page_count": 25,
          "creation_date": "2024-01-10T09:00:00Z"
        },
        "processing_time": 2.5,
        "timestamp": "2024-01-20T10:06:15Z"
      }
    },
    "处理速度更新消息": {
      "type": "speed_update",
      "data": {
        "index_id": 1,
        "current_speed": "15 文件/秒",
        "average_speed": "12 文件/秒",
        "peak_speed": "18 文件/秒",
        "speed_trend": "increasing",
        "performance_metrics": {
          "files_per_minute": 900,
          "mb_per_minute": 125,
          "cpu_usage": "35%",
          "memory_usage": "512MB",
          "io_read_rate": "25MB/s",
          "io_write_rate": "8MB/s"
        },
        "estimated_completion": "2024-01-20T10:13:45Z",
        "timestamp": "2024-01-20T10:07:00Z"
      }
    },
    "错误发生消息": {
      "type": "error_occurred",
      "data": {
        "index_id": 1,
        "error_info": {
          "file_path": "D:/Documents/损坏文件.pdf",
          "error_type": "FILE_CORRUPTED",
          "error_message": "PDF文件损坏，无法读取内容",
          "error_code": "PDF_PARSE_ERROR",
          "stack_trace": "pdf.parser.PdfReadError: EOF marker not found",
          "recovery_attempted": true,
          "recovery_successful": false
        },
        "impact": {
          "files_skipped": 1,
          "progress_impact": "none",
          "can_continue": true
        },
        "error_count": 3,
        "total_errors": 3,
        "timestamp": "2024-01-20T10:08:30Z"
      }
    },
    "警告消息": {
      "type": "warning",
      "data": {
        "index_id": 1,
        "warning_info": {
          "file_path": "D:/Documents/大型视频.mp4",
          "warning_type": "LARGE_FILE_SIZE",
          "warning_message": "文件大小超过500MB限制，已跳过",
          "file_size": 1073741824,
          "limit": 524288000
        },
        "warnings_count": 2,
        "total_warnings": 2,
        "timestamp": "2024-01-20T10:09:15Z"
      }
    },
    "任务完成消息": {
      "type": "completed",
      "data": {
        "index_id": 1,
        "status": "completed",
        "progress": 100,
        "processed_files": 98,
        "total_files": 100,
        "skipped_files": 2,
        "error_count": 3,
        "warning_count": 5,
        "completion_time": "2024-01-20T10:15:32Z",
        "total_duration": "15 分 32 秒",
        "performance_summary": {
          "average_speed": "6.3 文件/秒",
          "total_size_processed": "2.8GB",
          "index_size_created": "1.2GB",
          "peak_memory_usage": "1.5GB"
        },
        "file_types_summary": {
          "pdf": { "processed": 24, "skipped": 1 },
          "docx": { "processed": 30, "skipped": 0 },
          "txt": { "processed": 15, "skipped": 0 },
          "md": { "processed": 19, "skipped": 1 },
          "xlsx": { "processed": 10, "skipped": 0 }
        },
        "index_stats": {
          "documents_indexed": 95,
          "total_tokens": 2456789,
          "unique_terms": 45678,
          "index_version": "v2.1"
        },
        "next_actions": [
          "索引已可用进行搜索",
          "建议进行索引验证",
          "可以查看详细统计报告"
        ]
      }
    },
    "任务暂停消息": {
      "type": "paused",
      "data": {
        "index_id": 1,
        "status": "paused",
        "progress": 67,
        "processed_files": 67,
        "total_files": 100,
        "pause_reason": "用户手动暂停",
        "pause_time": "2024-01-20T10:12:45Z",
        "can_resume": true,
        "resume_point": {
          "last_file": "D:/Documents/chapter7.pdf",
          "next_file": "D:/Documents/chapter8.pdf"
        },
        "timestamp": "2024-01-20T10:12:45Z"
      }
    },
    "任务取消消息": {
      "type": "cancelled",
      "data": {
        "index_id": 1,
        "status": "cancelled",
        "progress": 32,
        "processed_files": 32,
        "total_files": 100,
        "cancel_reason": "用户取消",
        "cancel_time": "2024-01-20T10:08:20Z",
        "cleanup_status": "in_progress",
        "cleanup_actions": [
          "删除临时文件",
          "释放内存资源",
          "关闭数据库连接"
        ],
        "can_restart": true,
        "timestamp": "2024-01-20T10:08:20Z"
      }
    },
    "心跳消息": {
      "type": "heartbeat",
      "data": {
        "index_id": 1,
        "status": "processing",
        "server_time": "2024-01-20T10:10:00Z",
        "connection_id": "conn_1234567890",
        "uptime": "10 分 30 秒",
        "message_count": 45,
        "timestamp": "2024-01-20T10:10:00Z"
      }
    },
    "连接错误消息": {
      "type": "connection_error",
      "data": {
        "error_code": "INDEX_NOT_FOUND",
        "error_message": "索引任务不存在",
        "index_id": 999,
        "suggestion": "请检查索引ID是否正确",
        "timestamp": "2024-01-20T10:00:00Z"
      }
    }
  },
  "连接状态事件": {
    "连接建立": {
      "event": "connected",
      "data": {
        "connection_id": "conn_1234567890",
        "index_id": 1,
        "server_time": "2024-01-20T10:00:00Z",
        "welcome_message": "已连接到索引任务进度推送"
      }
    },
    "连接断开": {
      "event": "disconnected",
      "data": {
        "reason": "client_disconnect",
        "connection_id": "conn_1234567890",
        "duration": "15 分 32 秒",
        "messages_sent": 67
      }
    },
    "连接超时": {
      "event": "timeout",
      "data": {
        "reason": "heartbeat_timeout",
        "idle_duration": "5 分 00 秒",
        "auto_reconnect": true
      }
    }
  },
  "使用说明": {
    "集成方式": "建立WebSocket连接后，实时接收索引进度更新",
    "连接流程": [
      "建立WebSocket连接",
      "验证索引ID有效性",
      "订阅进度推送",
      "接收实时消息",
      "处理断线重连"
    ],
    "消息处理": [
      "进度更新：更新进度条和状态",
      "错误消息：显示错误信息和解决建议",
      "完成消息：显示最终统计和后续操作",
      "心跳消息：维持连接活跃"
    ],
    "重连机制": {
      "自动重连": "连接断开时自动尝试重连",
      "重连间隔": "指数退避策略",
      "最大重试": "默认5次",
      "恢复状态": "重连后同步当前状态"
    },
    "性能优化": {
      "消息压缩": "大文件信息使用压缩传输",
      "消息合并": "快速连续消息进行合并",
      "频率控制": "避免过于频繁的消息推送"
    },
    "错误处理": {
      "连接错误": "显示连接状态和重试选项",
      "消息格式错误": "忽略无效消息并记录日志",
      "服务器错误": "显示错误详情和联系信息"
    }
  }
}