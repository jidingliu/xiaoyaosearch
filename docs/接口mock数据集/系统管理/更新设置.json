{
  "接口信息": {
    "接口路径": "POST /api/settings",
    "功能说明": "更新应用程序设置配置，支持部分更新和批量更新",
    "请求方式": "POST",
    "Content-Type": "application/json",
    "接口版本": "v1.0.0"
  },
  "请求参数": {
    "搜索设置更新场景": {
      "search": {
        "default_limit": 30,
        "default_threshold": 0.75,
        "result_highlight": true,
        "cache_enabled": true,
        "cache_ttl": 7200
      }
    },
    "界面设置更新场景": {
      "ui": {
        "theme": "dark",
        "language": "en-US",
        "font_size": 16,
        "window_size": {
          "width": 1400,
          "height": 900
        },
        "show_advanced_options": true
      }
    },
    "AI模型设置更新场景": {
      "ai_models": {
        "embedding_model": {
          "model_name": "bge-large",
          "provider": "local",
          "device": "cuda"
        },
        "speech_model": {
          "auto_load": true
        },
        "auto_update_models": true
      }
    },
    "隐私设置更新场景": {
      "privacy": {
        "anonymous_usage_stats": false,
        "search_analytics": true,
        "privacy_mode": true,
        "data_collection": "essential"
      }
    },
    "性能设置更新场景": {
      "performance": {
        "max_memory_usage": 4096,
        "max_cpu_usage": 90,
        "enable_gpu_acceleration": true,
        "gpu_device": "cuda:0",
        "preload_models": true
      }
    },
    "网络设置更新场景": {
      "network": {
        "proxy_enabled": true,
        "proxy_host": "proxy.company.com",
        "proxy_port": 8080,
        "timeout": 60,
        "retry_attempts": 5
      }
    },
    "批量更新场景": {
      "search": {
        "default_limit": 25,
        "max_file_size": 104857600
      },
      "ui": {
        "theme": "light",
        "result_view_mode": "grid"
      },
      "privacy": {
        "auto_save_search_history": true,
        "max_history_items": 50
      }
    },
    "参数无效场景": {
      "search": {
        "default_limit": 0,
        "default_threshold": 1.5,
        "max_file_size": -1
      },
      "ui": {
        "theme": "invalid_theme",
        "language": "invalid_lang"
      }
    },
    "权限不足场景": {
      "advanced": {
        "debug_mode": true,
        "enable_profiling": true
      }
    }
  },
  "响应数据": {
    "搜索设置更新成功响应": {
      "success": true,
      "message": "搜索设置更新成功",
      "data": {
        "updated_fields": [
          "search.default_limit",
          "search.default_threshold",
          "search.result_highlight",
          "search.cache_enabled",
          "search.cache_ttl"
        ],
        "validation_passed": true,
        "restart_required": false,
        "applied_immediately": true,
        "backup_created": true,
        "backup_file": "./settings/backup/settings_20240120_163000.json"
      }
    },
    "界面设置更新成功响应": {
      "success": true,
      "message": "界面设置更新成功，部分设置需要重启应用后生效",
      "data": {
        "updated_fields": [
          "ui.theme",
          "ui.language",
          "ui.font_size",
          "ui.window_size.width",
          "ui.window_size.height",
          "ui.show_advanced_options"
        ],
        "validation_passed": true,
        "restart_required": true,
        "applied_immediately": false,
        "pending_changes": [
          "界面语言变更",
          "窗口大小设置"
        ],
        "effective_after_restart": [
          "ui.language",
          "ui.window_size"
        ]
      }
    },
    "AI模型设置更新成功响应": {
      "success": true,
      "message": "AI模型设置更新成功，正在重新加载模型",
      "data": {
        "updated_fields": [
          "ai_models.embedding_model.model_name",
          "ai_models.embedding_model.provider",
          "ai_models.embedding_model.device",
          "ai_models.speech_model.auto_load",
          "ai_models.auto_update_models"
        ],
        "validation_passed": true,
        "restart_required": false,
        "model_reload_required": true,
        "reloading_models": [
          "bge-large",
          "faster-whisper"
        ],
        "estimated_reload_time": "2-3 分钟",
        "current_status": "reloading"
      }
    },
    "隐私设置更新成功响应": {
      "success": true,
      "message": "隐私设置更新成功",
      "data": {
        "updated_fields": [
          "privacy.anonymous_usage_stats",
          "privacy.search_analytics",
          "privacy.privacy_mode",
          "privacy.data_collection"
        ],
        "validation_passed": true,
        "restart_required": false,
        "data_cleanup_triggered": true,
        "cleanup_actions": [
          "清除匿名使用统计数据",
          "删除搜索分析记录"
        ],
        "new_privacy_status": "enhanced"
      }
    },
    "性能设置更新成功响应": {
      "success": true,
      "message": "性能设置更新成功，正在优化系统配置",
      "data": {
        "updated_fields": [
          "performance.max_memory_usage",
          "performance.max_cpu_usage",
          "performance.enable_gpu_acceleration",
          "performance.gpu_device",
          "performance.preload_models"
        ],
        "validation_passed": true,
        "restart_required": false,
        "optimization_in_progress": true,
        "performance_impact": {
          "memory_usage_increase": "+2GB",
          "cpu_performance_boost": "+25%",
          "gpu_utilization": "启用"
        },
        "current_allocation": {
          "memory_allocated": "4GB",
          "cpu_limit": "90%",
          "gpu_memory": "2GB"
        }
      }
    },
    "网络设置更新成功响应": {
      "success": true,
      "message": "网络设置更新成功，正在测试连接",
      "data": {
        "updated_fields": [
          "network.proxy_enabled",
          "network.proxy_host",
          "network.proxy_port",
          "network.timeout",
          "network.retry_attempts"
        ],
        "validation_passed": true,
        "restart_required": false,
        "connection_test": "in_progress",
        "proxy_configuration": {
          "status": "configured",
          "test_url": "https://www.google.com",
          "expected_response": "200 OK"
        }
      }
    },
    "批量更新成功响应": {
      "success": true,
      "message": "批量设置更新成功",
      "data": {
        "updated_fields": [
          "search.default_limit",
          "search.max_file_size",
          "ui.theme",
          "ui.result_view_mode",
          "privacy.auto_save_search_history",
          "privacy.max_history_items"
        ],
        "validation_passed": true,
        "restart_required": false,
        "modules_affected": [
          "search",
          "ui",
          "privacy"
        ],
        "total_changes": 6,
        "backup_created": true
      }
    },
    "参数验证错误响应": {
      "success": false,
      "error": {
        "code": "VALIDATION_ERROR",
        "message": "设置参数验证失败",
        "details": {
          "invalid_fields": [
            {
              "field": "search.default_limit",
              "value": 0,
              "error": "必须为1-100之间的整数"
            },
            {
              "field": "search.default_threshold",
              "value": 1.5,
              "error": "必须为0.0-1.0之间的数值"
            },
            {
              "field": "ui.theme",
              "value": "invalid_theme",
              "error": "主题必须是light/dark之一"
            }
          ]
        },
        "suggestions": [
          "检查数值范围是否正确",
          "确认枚举值是否在允许范围内",
          "验证数据类型是否匹配"
        ]
      }
    },
    "权限不足错误响应": {
      "success": false,
      "error": {
        "code": "PERMISSION_DENIED",
        "message": "没有修改高级设置的权限",
        "details": "debug_mode和enable_profiling需要管理员权限或开发者模式",
        "suggestions": [
          "以管理员身份运行应用程序",
          "启用开发者模式",
          "联系系统管理员获取权限"
        ]
      }
    },
    "设置冲突错误响应": {
      "success": false,
      "error": {
        "code": "SETTINGS_CONFLICT",
        "message": "设置参数存在冲突",
        "details": {
          "conflicts": [
            {
              "field1": "performance.max_memory_usage",
              "value1": 8192,
              "field2": "system.available_memory",
              "value2": 4096,
              "message": "最大内存使用量不能超过系统可用内存"
            },
            {
              "field1": "privacy.privacy_mode",
              "value1": true,
              "field2": "privacy.anonymous_usage_stats",
              "value2": true,
              "message": "隐私模式下不能启用匿名使用统计"
            }
          ]
        },
        "suggestions": [
          "调整性能设置以匹配系统资源",
          "检查隐私设置的一致性",
          "使用推荐设置避免冲突"
        ]
      }
    },
    "文件保存失败响应": {
      "success": false,
      "error": {
        "code": "FILE_SAVE_FAILED",
        "message": "设置文件保存失败",
        "details": "磁盘空间不足或文件被占用",
        "suggestions": [
          "清理磁盘空间",
          "关闭其他可能占用文件的应用程序",
          "检查文件权限设置"
        ]
      }
    },
    "依赖检查失败响应": {
      "success": false,
      "error": {
        "code": "DEPENDENCY_CHECK_FAILED",
        "message": "设置依赖检查失败",
        "details": {
          "missing_dependencies": [
            {
              "setting": "performance.enable_gpu_acceleration",
              "dependency": "CUDA驱动程序",
              "status": "未安装"
            },
            {
              "setting": "ai_models.embedding_model.device",
              "dependency": "兼容的GPU设备",
              "status": "未检测到"
            }
          ]
        },
        "suggestions": [
          "安装CUDA驱动程序",
          "检查GPU硬件兼容性",
          "使用CPU模式作为替代方案"
        ]
      }
    }
  },
  "使用说明": {
    "集成方式": "提供设置保存功能，支持实时验证和错误提示",
    "测试建议": [
      "测试各种设置组合的更新",
      "测试参数验证和错误处理",
      "测试设置冲突检测",
      "测试权限管理和安全控制"
    ],
    "验证规则": [
      "数据类型检查",
      "数值范围验证",
      "枚举值验证",
      "依赖关系检查",
      "权限验证"
    ],
    "更新流程": [
      "参数验证",
      "依赖检查",
      "冲突检测",
      "权限验证",
      "备份当前设置",
      "应用新设置",
      "验证应用结果"
    ],
    "实时应用": {
      "立即生效": "界面主题、语言等",
      "需要重启": "语言切换、窗口大小等",
      "后台处理": "模型重新加载、索引重建等"
    },
    "错误恢复": [
      "自动回滚失败的设置",
      "从备份恢复设置",
      "提供详细错误信息",
      "建议解决方案"
    ]
  }
}